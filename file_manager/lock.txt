locked and writing to file